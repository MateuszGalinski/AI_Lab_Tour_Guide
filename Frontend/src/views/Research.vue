<template>
  <PageStructure title="Researchers">
    <label class="input w-full">
      <svg
        class="h-[1em] opacity-50"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
      >
        <g
          stroke-linejoin="round"
          stroke-linecap="round"
          stroke-width="2.5"
          fill="none"
          stroke="currentColor"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.3-4.3"></path>
        </g>
      </svg>
      <input
        v-model="searchQuery"
        type="search"
        class="grow"
        placeholder="Search"
      />
    </label>
    <Card
      v-for="research in filteredResults"
      :key="research.id"
      :card-image="ResearchBanner"
      card-image-alt="Research Banner"
      :card-title="research.name"
      :card-text="research.summary"
      button-title="Learn more"
      tooltip-text="This image has been generated by AI. It is not related to the research."
      :link="'/research/' + research.id?.toString()"
    />
  </PageStructure>
</template>
<script setup lang="ts">
import Card from "../components/Card.vue";
import { computed, ref, watch } from "vue";
import { useApiFetch } from "../api/useApiFetch.ts";
import type { Research } from "../types/types.ts";
import ResearchBanner from "../assets/img/research-paper-banner-ai.png";
import PageStructure from "../components/PageStructure.vue";

const searchQuery = ref("");
const result = ref<Research[]>([]);

const { data } = useApiFetch<Research[]>("research");

watch(data, () => {
  if (data.value) {
    result.value = data.value;
  }
});

const filteredResults = computed(() => {
  return result.value.filter(
    (research) =>
      research.name.toLowerCase().includes(searchQuery.value.toLowerCase()) ||
      research.summary?.toLowerCase().includes(searchQuery.value.toLowerCase()),
  );
});
</script>
